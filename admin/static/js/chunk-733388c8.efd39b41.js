(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-733388c8"],{"5f46":function(t,e,a){"use strict";var n=a("cc3e"),i=a.n(n);i.a},7514:function(t,e,a){"use strict";var n=a("5ca1"),i=a("0a49")(5),o="find",r=!0;o in[]&&Array(1)[o](function(){r=!1}),n(n.P+n.F*r,"Array",{find:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),a("9c6c")(o)},bdc9:function(t,e,a){"use strict";a.d(e,"d",function(){return i}),a.d(e,"e",function(){return o}),a.d(e,"f",function(){return r}),a.d(e,"b",function(){return l}),a.d(e,"c",function(){return s}),a.d(e,"a",function(){return c});var n=a("b775");function i(t){return Object(n["a"])({url:"api.php?a=getBanks",method:"get",params:t})}function o(t){return Object(n["a"])({url:"api.php?a=bankMain",method:"get",params:t})}function r(t){return Object(n["a"])({url:"api.php?a=cardPool",method:"get",params:t})}function l(t){return Object(n["a"])({url:"api.php?a=cardPoolSite",method:"post",data:t})}function s(t){return Object(n["a"])({url:"api.php?a=editBank",method:"post",data:t})}function c(t){return Object(n["a"])({url:"api.php?a=bankslogs",method:"get",params:t})}},cc3e:function(t,e,a){},efc9:function(t,e,a){"use strict";a.r(e);var n=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("div",{staticClass:"banks"},[a("h4",{staticClass:"title"},[t._v("\n    银行卡管理\n  ")]),t._v(" "),a("el-form",{staticClass:"demo-form-inline",attrs:{inline:!0,model:t.query,size:"small"}},[a("el-form-item",{attrs:{label:"银行卡账号"}},[a("el-input",{attrs:{placeholder:"请输入银行卡",clearable:""},model:{value:t.query.card_no,callback:function(e){t.$set(t.query,"card_no",e)},expression:"query.card_no"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"时间"}},[a("el-date-picker",{attrs:{type:"datetimerange","picker-options":t.pickerOptions,"value-format":"yyyy-MM-dd HH:mm:ss","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期",align:"right"},model:{value:t.query.range,callback:function(e){t.$set(t.query,"range",e)},expression:"query.range"}})],1),t._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:t.onSearch}},[t._v("查询")]),t._v(" "),a("el-button",{attrs:{icon:"el-icon-setting",loading:t.cardPollLoading},on:{click:function(e){return t.onDialogSite()}}},[t._v("卡池设置\n      ")])],1)],1),t._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:t.tableLoading,expression:"tableLoading"}],staticStyle:{width:"100%"},attrs:{data:t.tableData.list,border:"",size:"small"},on:{"sort-change":t.tableSort}},[a("el-table-column",{attrs:{width:"80px",prop:"id",label:"id"}}),t._v(" "),a("el-table-column",{attrs:{label:"基本信息"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-collapse",{attrs:{accordion:""}},[a("el-collapse-item",[a("template",{slot:"title"},[a("p",[t._v("姓名："+t._s(e.row.name))])]),t._v(" "),a("p",{staticStyle:{"font-size":"12px"}},[t._v("类别："+t._s(e.row.bank_type))]),t._v(" "),a("p",{staticStyle:{"font-size":"12px"}},[t._v("卡号："+t._s(e.row.card_no))])],2)],1)]}}])}),t._v(" "),a("el-table-column",{attrs:{width:"150px",prop:"balance",sortable:"custom",label:"余额"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",{staticStyle:{color:"#F56C6C"}},[t._v("\n                          "+t._s(t._f("moneyFormat")(e.row.balance))+"\n                      ")])]}}])}),t._v(" "),a("el-table-column",{attrs:{prop:"created_at",label:"时间"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-collapse",{attrs:{accordion:""}},[a("el-collapse-item",[a("template",{slot:"title"},[a("p",{staticStyle:{"font-size":"12px"}},[t._v("更新："+t._s(e.row.updated_at))])]),t._v(" "),a("p",{staticStyle:{"font-size":"12px"}},[t._v("创建："+t._s(e.row.created_at))])],2)],1)]}}])}),t._v(" "),a("el-table-column",{attrs:{width:"60px",prop:"successOrders",label:"成功"}}),t._v(" "),a("el-table-column",{attrs:{width:"60px",prop:"errorOrders",label:"失败"}}),t._v(" "),a("el-table-column",{attrs:{width:"60px",prop:"loadingOrders",label:"进行"}}),t._v(" "),a("el-table-column",{attrs:{width:"80px",prop:"rate",label:"成功率"}}),t._v(" "),a("el-table-column",{attrs:{width:"120px",label:"流水"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("span",[t._v(t._s(t._f("moneyFormat")(Math.abs(e.row.sum).toFixed(2))))])]}}])}),t._v(" "),a("el-table-column",{attrs:{width:"80px",prop:"online",label:"状态"},scopedSlots:t._u([{key:"default",fn:function(e){return[e.row.online<=6e4?a("i",{staticClass:"el-icon-success",staticStyle:{color:"#67c23a"}},[t._v("在线")]):a("i",{staticClass:"el-icon-error",staticStyle:{color:"#f56c6c"}},[t._v("离线")])]}}])}),t._v(" "),a("el-table-column",{attrs:{width:"80px",prop:"main",sortable:"custom",label:"主卡"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-switch",{attrs:{"inactive-value":"0","active-value":"1","active-color":"#13ce66","inactive-color":"#ff4949"},on:{change:function(a){return t.onBankMain(e.row)}},model:{value:e.row.main,callback:function(a){t.$set(e.row,"main",a)},expression:"scope.row.main"}})]}}])}),t._v(" "),a("el-table-column",{attrs:{label:"操作",width:"162px"},scopedSlots:t._u([{key:"default",fn:function(e){return[a("el-button",{attrs:{size:"mini"},on:{click:function(a){return t.onDialogEdit(e.row)}}},[t._v("编辑\n        ")]),t._v(" "),a("router-link",{attrs:{to:"/banks/index/"+e.row.card_no+"&"+e.row.name}},[a("el-button",{attrs:{size:"mini"}},[t._v("查看明细\n          ")])],1)]}}])})],1),t._v(" "),a("div",{staticClass:"block",staticStyle:{"margin-top":"20px","text-align":"right"}},[a("el-pagination",{attrs:{"current-page":t.query.page,"page-size":t.query.count,layout:"sizes ,prev, pager, next","page-sizes":[10,20,30,40,50,100],total:t.tableData.total},on:{"size-change":t.handleSizeChange,"update:currentPage":function(e){return t.$set(t.query,"page",e)},"update:current-page":function(e){return t.$set(t.query,"page",e)},"current-change":t.handleCurrentChange}})],1),t._v(" "),a("el-dialog",{attrs:{title:"卡池设置",visible:t.dialog.visible,width:"600px"},on:{"update:visible":function(e){return t.$set(t.dialog,"visible",e)}}},[a("el-form",{ref:"dialogForm",staticClass:"form-small",attrs:{model:t.dialog.form,rules:t.dialog.rules,"label-width":"110px"}},[a("el-form-item",{attrs:{label:"1.",prop:"open"}},[a("el-checkbox-group",{model:{value:t.dialog.form.open,callback:function(e){t.$set(t.dialog.form,"open",e)},expression:"dialog.form.open"}},[a("el-checkbox",{attrs:{label:"1",name:"open"}},[t._v("开启卡内转账")])],1)],1),t._v(" "),a("el-form-item",{attrs:{label:"2.",prop:"sub_card_money"}},[t._v("\n        副卡金额小于\n        "),a("el-input",{attrs:{maxlength:"10",placeholder:"0"},model:{value:t.dialog.form.sub_card_money,callback:function(e){t.$set(t.dialog.form,"sub_card_money",e)},expression:"dialog.form.sub_card_money"}},[a("template",{slot:"append"},[t._v("元")])],2),t._v("\n        主卡自动转入\n      ")],1),t._v(" "),a("el-form-item",{attrs:{label:"3.",prop:"main_to_sub"}},[t._v("\n        每次转入\n        "),a("el-input",{attrs:{maxlength:"10",placeholder:"0"},model:{value:t.dialog.form.main_to_sub,callback:function(e){t.$set(t.dialog.form,"main_to_sub",e)},expression:"dialog.form.main_to_sub"}},[a("template",{slot:"append"},[t._v("元")])],2)],1),t._v(" "),a("el-form-item",{attrs:{label:"4.",prop:"main_card_money"}},[t._v("\n        主卡金额小于\n        "),a("el-input",{attrs:{maxlength:"10",placeholder:"0"},model:{value:t.dialog.form.main_card_money,callback:function(e){t.$set(t.dialog.form,"main_card_money",e)},expression:"dialog.form.main_card_money"}},[a("template",{slot:"append"},[t._v("元")])],2),t._v("\n        报警\n      ")],1),t._v(" "),a("el-form-item",[a("el-button",{on:{click:function(e){t.dialog.visible=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary",loading:t.dialog.btnLoading,disabled:t.dialog.btnDisabled},on:{click:function(e){return t.onDialogFormSubmit()}}},[t._v("确 定\n        ")])],1)],1)],1),t._v(" "),a("el-dialog",{attrs:{title:"银行卡编辑",visible:t.dialogEdit.visible,width:"600px"},on:{"update:visible":function(e){return t.$set(t.dialogEdit,"visible",e)}}},[a("el-form",{ref:"dialogEditForm",attrs:{model:t.dialogEdit.form,rules:t.dialogEdit.rules,"label-width":"110px"},nativeOn:{submit:function(t){t.preventDefault()}}},[a("el-form-item",{attrs:{label:"卡号",prop:"card_no"}},[a("span",[t._v(t._s(t.dialogEdit.form.card_no))])]),t._v(" "),a("el-form-item",{attrs:{label:"姓名",prop:"name"}},[a("el-input",{attrs:{maxlength:"8",placeholder:"请输入姓名"},model:{value:t.dialogEdit.form.name,callback:function(e){t.$set(t.dialogEdit.form,"name",e)},expression:"dialogEdit.form.name"}})],1),t._v(" "),a("el-form-item",{attrs:{label:"类别",prop:"bank_type"}},[a("el-input",{attrs:{maxlength:"30",placeholder:"请输入银行卡类别"},model:{value:t.dialogEdit.form.bank_type,callback:function(e){t.$set(t.dialogEdit.form,"bank_type",e)},expression:"dialogEdit.form.bank_type"}})],1),t._v(" "),a("el-form-item",[a("el-button",{on:{click:function(e){t.dialogEdit.visible=!1}}},[t._v("取 消")]),t._v(" "),a("el-button",{attrs:{type:"primary",loading:t.dialogEdit.btnLoading,disabled:t.dialogEdit.btnDisabled},on:{click:function(e){return t.onDialogEditFormSubmit()}}},[t._v("确 定\n        ")])],1)],1)],1)],1)},i=[],o=(a("7514"),a("6b54"),a("28a5"),a("7f7f"),a("bdc9")),r={name:"index",data:function(){return{set:null,query:{count:100,page:1},tableData:{list:[],count:0,total:0},tableLoading:!1,cardPollLoading:!1,pickerOptions:{shortcuts:[{text:"最近一周",onClick:function(t){var e=new Date,a=new Date;a.setTime(a.getTime()-6048e5),t.$emit("pick",[a,e])}},{text:"最近一个月",onClick:function(t){var e=new Date,a=new Date;a.setTime(a.getTime()-2592e6),t.$emit("pick",[a,e])}},{text:"最近三个月",onClick:function(t){var e=new Date,a=new Date;a.setTime(a.getTime()-7776e6),t.$emit("pick",[a,e])}}]},dialog:{visible:!1,btnLoading:!1,btnDisabled:!0,form:{open:[],sub_card_money:0,main_to_sub:0,main_card_money:0},rules:{sub_card_money:[{pattern:/^[0-9]+$/,message:"不能包含字符串或其他特殊字符",trigger:"change"}],main_to_sub:[{pattern:/^[0-9]+$/,message:"不能包含字符串或其他特殊字符",trigger:"change"}],main_card_money:[{pattern:/^[0-9]+$/,message:"不能包含字符串或其他特殊字符",trigger:"change"}]}},dialogEdit:{visible:!1,btnLoading:!1,btnDisabled:!0,form:{id:0,card_no:0,name:""},rules:{name:[{required:!0,message:"姓名不能为空",trigger:"blur"},{pattern:/^[A-Za-z\u4e00-\u9fa5]+$/,message:"不能包含字符串或其他特殊字符",trigger:"change"}],bank_type:[{required:!0,message:"银行卡类别不能为空",trigger:"blur"},{pattern:/^[0-9A-Za-z\u4e00-\u9fa5]+$/,message:"不能包含字符串或其他特殊字符",trigger:"change"}]}}}},created:function(){this.init()},filters:{getHref:function(t){return"bankslogs.html?card_no="+t.row.card_no+"&name="+t.row.name},moneyFormat:function(t){if(t){t=t.toString().split(".");for(var e=t[0].split("").reverse(),a=[],n=0,i=e.length;n<i;n++)n%3===0&&0!==n&&"-"!=e[n]&&a.push(","),a.push(e[n]);return a.reverse(),a=t[1]?a.join("").concat("."+t[1]):a.join(""),a}}},watch:{"dialog.visible":function(t,e){t?this.dialog.btnDisabled=!1:(this.dialog.btnDisabled=!0,this.$refs.dialogForm&&this.$refs.dialogForm.resetFields(),this.$refs.dialogForm&&this.$refs.dialogForm.clearValidate())},"dialogEdit.visible":function(t,e){t?this.dialogEdit.btnDisabled=!1:(this.dialogEdit.btnDisabled=!0,this.$refs.dialogEditForm&&this.$refs.dialogEditForm.resetFields(),this.$refs.dialogEditForm&&this.$refs.dialogEditForm.clearValidate())}},methods:{init:function(){var t=this;this.netTableData(!1),this.set=setTimeout(function(){t.init()},5e3)},tableSort:function(t,e,a){this.query.orderBy=t.prop,t.order?this.query.sort=t.order.split("ending")[0]:this.query.sort="asc",this.netTableData(!1)},onSearch:function(){this.query.page=1,this.netTableData(!0)},netTableData:function(t,e){var a=this;this.tableLoading=t,Object(o["d"])(this.query).then(function(t){var n=t.data;a.tableLoading=!1,n.list.map(function(t){Object.assign(t,{online:(new Date).getTime()-new Date(t.updated_at).getTime()})}),a.tableData=n,e&&e()}).catch(function(t){a.$message.error(t),a.tableLoading=!1,e&&e()})},handleCurrentChange:function(){this.netTableData(!0)},handleSizeChange:function(t){this.query.page=1,this.query.count=t,this.netTableData(!0)},onBankMain:function(t){var e=this;this.tableLoading=!0,Object(o["e"])({id:t.id,main:t.main}).then(function(t){e.netTableData(!0)}).catch(function(t){e.$message.error(t)})},onDialogSite:function(){var t=this;this.cardPollLoading=!0,Object(o["f"])().then(function(e){var a=e.data;if(a){var n=Object.assign({},a);n.open=[a.open],n.sub_card_money=parseInt(a.sub_card_money),n.main_to_sub=parseInt(a.main_to_sub),n.main_card_money=parseInt(a.main_card_money),t.dialog.form=n}t.dialog.visible=!0,t.cardPollLoading=!1}).catch(function(e){t.cardPollLoading=!1,t.$message.error(e)})},onDialogFormSubmit:function(){var t=this;this.$refs.dialogForm.validate(function(e){if(e){var a=Object.assign({},t.dialog.form);a.open=t.dialog.form.open.find(function(t){return 1==t}),a.open=1==a.open?1:0,Object(o["b"])(a).then(function(e){e.success?t.$message.success(e.data):t.$message.error(e.errMsg),t.dialog.visible=!1,t.dialog.btnLoading=!1}).catch(function(e){t.dialog.btnLoading=!1,t.$message.error(e)})}})},onDialogEdit:function(t){this.dialogEdit.visible=!0,this.dialogEdit.form=Object.assign({},t)},onDialogEditFormSubmit:function(){var t=this;this.$refs.dialogEditForm.validate(function(e){e&&(t.dialogEdit.btnLoading=!0,Object(o["c"])(t.dialogEdit.form).then(function(e){var a=e.data,n=e.success;n?t.$message.success(a):t.$message.error(a),t.dialogEdit.visible=!1,t.dialogEdit.btnLoading=!1,t.netTableData(!0)}).catch(function(e){t.dialogEdit.btnLoading=!1,t.$message.error(e)}))})}},destroyed:function(){clearTimeout(this.set)}},l=r,s=(a("5f46"),a("2877")),c=Object(s["a"])(l,n,i,!1,null,null,null);e["default"]=c.exports}}]);